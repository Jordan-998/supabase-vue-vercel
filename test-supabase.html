<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Supabase è¿æ¥æµ‹è¯•</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
    }
    .section {
      margin: 20px 0;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      background: #42b983;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background: #3aa876;
    }
    pre {
      background: #f5f5f5;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
    .success { color: green; }
    .error { color: red; }
    input {
      padding: 8px;
      margin: 5px;
      width: 200px;
    }
  </style>
</head>
<body>
  <h1>ğŸ§ª Supabase API æµ‹è¯•å·¥å…·</h1>

  <div class="section">
    <h2>1. æµ‹è¯•è¿æ¥</h2>
    <button onclick="testConnection()">æµ‹è¯• Supabase è¿æ¥</button>
    <pre id="connection-result">ç­‰å¾…æµ‹è¯•...</pre>
  </div>

  <div class="section">
    <h2>2. æµ‹è¯•è¡¨è®¿é—®</h2>
    <button onclick="testTableAccess()">æµ‹è¯• todos è¡¨è®¿é—®</button>
    <pre id="table-result">ç­‰å¾…æµ‹è¯•...</pre>
  </div>

  <div class="section">
    <h2>3. æµ‹è¯•æ’å…¥æ•°æ®</h2>
    <input type="text" id="test-title" placeholder="æµ‹è¯•å¾…åŠå†…å®¹" value="æµ‹è¯•å¾…åŠ">
    <button onclick="testInsert()">æ’å…¥æµ‹è¯•æ•°æ®</button>
    <pre id="insert-result">ç­‰å¾…æµ‹è¯•...</pre>
  </div>

  <div class="section">
    <h2>4. æµ‹è¯•æŸ¥è¯¢æ•°æ®</h2>
    <button onclick="testSelect()">æŸ¥è¯¢æ‰€æœ‰å¾…åŠ</button>
    <pre id="select-result">ç­‰å¾…æµ‹è¯•...</pre>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm'

    // Supabase é…ç½®
    const SUPABASE_URL = 'https://ypgvicuekjtfkmcyhvjj.supabase.co'
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlwZ3ZpY3Vla2p0ZmttY3lodmpqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIwMzEwNTAsImV4cCI6MjA4NzYwNzA1MH0.OZ3-t-jMN-9-cv2RK9NXzY7wPm9Hl7lLWqZza7Z-i2o'

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

    window.testConnection = async function() {
      const result = document.getElementById('connection-result')
      try {
        result.innerHTML = 'æ­£åœ¨æµ‹è¯•è¿æ¥...'
        const { data, error } = await supabase.from('todos').select('*').limit(0)

        if (error) {
          result.innerHTML = `<span class="error">è¿æ¥å¤±è´¥</span>\n${JSON.stringify(error, null, 2)}`
        } else {
          result.innerHTML = `<span class="success">âœ… è¿æ¥æˆåŠŸï¼</span>\nSupabase API å¯ä»¥è®¿é—®`
        }
      } catch (e) {
        result.innerHTML = `<span class="error">âŒ é”™è¯¯</span>\n${e.message}`
      }
    }

    window.testTableAccess = async function() {
      const result = document.getElementById('table-result')
      try {
        result.innerHTML = 'æ­£åœ¨æµ‹è¯•è¡¨è®¿é—®...'
        const { data, error } = await supabase.from('todos').select('*').limit(1)

        if (error) {
          result.innerHTML = `<span class="error">âŒ è¡¨è®¿é—®å¤±è´¥</span>\n${JSON.stringify(error, null, 2)}`
        } else {
          result.innerHTML = `<span class="success">âœ… todos è¡¨å¯ä»¥è®¿é—®ï¼</span>\nè¿”å›æ•°æ®: ${JSON.stringify(data, null, 2)}`
        }
      } catch (e) {
        result.innerHTML = `<span class="error">âŒ é”™è¯¯</span>\n${e.message}`
      }
    }

    window.testInsert = async function() {
      const result = document.getElementById('insert-result')
      const title = document.getElementById('test-title').value

      if (!title) {
        alert('è¯·è¾“å…¥æµ‹è¯•å†…å®¹')
        return
      }

      try {
        result.innerHTML = 'æ­£åœ¨æ’å…¥æµ‹è¯•æ•°æ®...'

        // é¦–å…ˆè·å–å½“å‰ç”¨æˆ·
        const { data: { user } } = await supabase.auth.getUser()

        if (!user) {
          result.innerHTML = `<span class="error">âŒ éœ€è¦å…ˆç™»å½•</span>\nè¯·å…ˆåœ¨ Supabase Dashboard ä¸­ç™»å½•ï¼Œæˆ–è€…ä½¿ç”¨æµ‹è¯•è´¦æˆ·`
          return
        }

        const { data, error } = await supabase
          .from('todos')
          .insert([{ title: title, user_id: user.id }])
          .select()

        if (error) {
          result.innerHTML = `<span class="error">âŒ æ’å…¥å¤±è´¥</span>\n${JSON.stringify(error, null, 2)}`
        } else {
          result.innerHTML = `<span class="success">âœ… æ’å…¥æˆåŠŸï¼</span>\n${JSON.stringify(data, null, 2)}`
        }
      } catch (e) {
        result.innerHTML = `<span class="error">âŒ é”™è¯¯</span>\n${e.message}`
      }
    }

    window.testSelect = async function() {
      const result = document.getElementById('select-result')
      try {
        result.innerHTML = 'æ­£åœ¨æŸ¥è¯¢æ•°æ®...'
        const { data, error } = await supabase.from('todos').select('*')

        if (error) {
          result.innerHTML = `<span class="error">âŒ æŸ¥è¯¢å¤±è´¥</span>\n${JSON.stringify(error, null, 2)}`
        } else {
          result.innerHTML = `<span class="success">âœ… æŸ¥è¯¢æˆåŠŸï¼</span>\næ‰¾åˆ° ${data.length} æ¡è®°å½•\n${JSON.stringify(data, null, 2)}`
        }
      } catch (e) {
        result.innerHTML = `<span class="error">âŒ é”™è¯¯</span>\n${e.message}`
      }
    }
  </script>
</body>
</html>
